{% extends 'bookingApp/base.html' %}
{% block title %}Dashboard: {{ business.name }}{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">

        <div>
            <h1 class="fw-bold mb-0 text-primary">Management: {{ business.name }}</h1>
            <p class="text-muted small">Manage your schedule, staff, and service offerings</p>
        </div>
        <span class="badge bg-primary fs-6 px-3 py-2 rounded-pill shadow-sm">{{ business.slug }}.example.com</span>
    </div>

    <ul class="nav nav-tabs mb-4 border-bottom-0" id="dashboardTabs" role="tablist">
        <li class="nav-item">
            <button class="nav-link active fw-bold px-4" id="appointments-tab" data-bs-toggle="tab" data-bs-target="#appointments" type="button">
                Incoming Appointments
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link fw-bold px-4" id="services-tab" data-bs-toggle="tab" data-bs-target="#services" type="button">
                Services
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link fw-bold px-4" id="staff-tab" data-bs-toggle="tab" data-bs-target="#staff" type="button">
                Staff Members
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link fw-bold px-4" id="forms-tab" data-bs-toggle="tab" data-bs-target="#forms" type="button">
                Booking Forms
            </button>
        </li>
    </ul>

    <div class="tab-content card border-0 shadow-sm p-4" id="dashboardTabsContent" style="border-radius: 16px;">
        
        <div class="tab-pane fade show active" id="appointments">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="fw-bold mb-0">Appointments</h4>
            </div>
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>Customer</th>
                            <th>Service</th>
                            <th>Staff</th>
                            <th>Date & Time</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for appointment in appointments %}
                        <tr>
                            <td class="fw-bold text-dark">{{ appointment.customer.username }}</td>
                            <td><span class="badge bg-primary bg-opacity-10 text-primary px-2 py-1">{{ appointment.service.name }}</span></td>
                            <td class="text-muted small">{{ appointment.staff.name|default:"Any" }}</td>
                            <td>{{ appointment.appointment_date|date:"D, M d" }} at {{ appointment.appointment_start_time|time:"H:i" }}</td>
                            <td>
                                <span class="badge rounded-pill badge-status-{{ appointment.status }} small">
                                    {{ appointment.get_status_display }}
                                </span>
                            </td>
                            <td>
                                <div class="d-flex gap-2">
                                    {% if appointment.status == 'pending' %}
                                        <a href="{% url 'appointment_email_decision' appointment.pk 'confirm' %}" class="btn btn-sm btn-primary rounded-pill px-3">
                                            Confirm
                                        </a>
                                        <a href="{% url 'appointment_email_decision' appointment.pk 'decline' %}" class="btn btn-sm btn-outline-danger rounded-pill px-3">
                                            Decline
                                        </a>
                                    {% else %}
                                        <a href="{% url 'appointment_detail' appointment.pk %}" class="btn btn-sm btn-light border rounded-pill px-3 text-muted">
                                            Manage
                                        </a>
                                        
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr><td colspan="6" class="text-center py-5 text-muted">No appointments scheduled yet.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="tab-pane fade" id="services">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="fw-bold mb-0">Offered Services</h4>
                <a href="{% url 'service_create' business.id %}" class="btn btn-sm btn-success rounded-pill px-3">+ Add Service</a>
            </div>
            <div class="row g-3">
                {% for s in services %}
                <div class="col-md-6">
                    <div class="border rounded-3 p-3 d-flex justify-content-between align-items-center">
                        <div>
                            <div class="fw-bold text-dark">{{ s.name }}</div>
                            <div class="small text-muted">{{ s.default_length_minutes }} min â€¢ ${{ s.price }}</div>
                        </div>
                        <span class="badge bg-light text-dark border">Active</span>
                    </div>
                </div>
                {% empty %}
                <div class="col-12 text-center py-4 text-muted">No services created.</div>
                {% endfor %}
            </div>
        </div>

        <div class="tab-pane fade" id="staff">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="fw-bold mb-0">Staff Members</h4>
                <a href="{% url 'staff_create' business.id %}" class="btn btn-sm btn-success rounded-pill px-3">+ Add Staff</a>
            </div>
            <div class="list-group list-group-flush">
                {% for s in staff_members %}
                <div class="list-group-item d-flex justify-content-between align-items-center px-0 py-3">
                    <div class="d-flex align-items-center">
                        <div class="bg-primary bg-opacity-10 text-primary rounded-circle p-2 me-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person-badge" viewBox="0 0 16 16">
                                <path d="M6.5 2a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1h-3zM11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                                <path d="M0 7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-1v2a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1v-2H2a2 2 0 0 1-2-2V7zm3.5 1a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1h-9z"/>
                            </svg>
                        </div>
                        <div>
                            <div class="fw-bold">{{ s.name }}</div>
                            <div class="small text-muted">{{ s.email|default:"No email provided" }}</div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-4 text-muted">No staff members listed.</div>
                {% endfor %}
            </div>
        </div>

        <div class="tab-pane fade" id="forms">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="fw-bold mb-0">Booking Forms</h4>
                <a href="{% url 'booking_form_create' business.id %}" class="btn btn-sm btn-success rounded-pill px-3">+ Create New</a>
            </div>
            <div class="row g-3">
                {% for form in booking_forms %}
                <div class="col-12">
                    <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center p-3 rounded-3 border">
                        <div>
                            <h6 class="mb-1 fw-bold text-dark">{{ form.name }}</h6>
                            <p class="mb-0 small text-muted">Embed Token: <code>{{ form.embed_token|truncatechars:20 }}</code></p>
                        </div>
                        <a href="{% url 'booking_form_edit' business.id form.id %}" class="btn btn-outline-secondary btn-sm rounded-pill px-3">Edit Form</a>
                    </div>
                </div>
                {% empty %}
                <div class="col-12 text-center py-4 text-muted">No booking forms created.</div>
                {% endfor %}
            </div>
        </div>

    </div>
</div>

<style>
    body { background-color: #f8fafc; }
    /* Status Badge Colors */
    .badge-status-pending { background-color: #fef3c7; color: #92400e; }
    .badge-status-confirmed { background-color: #dcfce7; color: #166534; }
    .badge-status-declined { background-color: #fee2e2; color: #991b1b; }
    .badge-status-completed { background-color: #dbeafe; color: #1e40af; }
    .badge-status-reschedule_requested { background-color: #f3e8ff; color: #6b21a8; }

    /* Custom Nav Styling */
    .nav-tabs .nav-link {
        color: #64748b;
        border: none;
        border-bottom: 3px solid transparent;
        transition: all 0.2s ease;
    }
    .nav-tabs .nav-link.active {
        color: #2563eb;
        background: transparent;
        border-bottom: 3px solid #2563eb;
    }
    .nav-tabs .nav-link:hover:not(.active) {
        border-bottom: 3px solid #e2e8f0;
    }
</style>
{% endblock %}